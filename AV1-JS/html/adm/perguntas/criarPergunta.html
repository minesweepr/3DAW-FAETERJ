<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Criar Pergunta</title>
  <link rel="stylesheet" href="../../../css/geral.css"> 
  <link rel="stylesheet" href="../../../css/form.css"> 
  <style>.multipla{display: none;}</style>

  <script>
    function mostrarCampos(){
      const tipo=document.getElementById("tipo").value;
      document.querySelector(".multipla").style.display=tipo ==="multipla"?"block" : "none";
    }

    function enviarPergunta() {
      const tipo=document.getElementById("tipo").value;
      const texto=document.getElementById("texto").value;

      if(!texto){
        document.getElementById("msg").innerText="preencha a pergunta";
        return;
      }
      let params="tipo="+ tipo +"&texto="+ texto;
      if(tipo==="multipla"){
        const opc_a=document.getElementById("opc_a").value;
        const opc_b=document.getElementById("opc_b").value;
        const opc_c=document.getElementById("opc_c").value;
        const resposta=document.getElementById("resposta").value;
        params+= "&opc_a=" + opc_a +"&opc_b=" + opc_b +"&opc_c=" + opc_c +"&resposta=" + resposta;
      }

      const xmlhttp=new XMLHttpRequest();
      xmlhttp.onreadystatechange=function(){
        if(this.readyState===4){
          if(this.status===200){
            try{
              const resp=JSON.parse(this.responseText);
              document.getElementById("msg").innerText=resp.sucesso||resp.erro;
              if(resp.sucesso) document.querySelector("form").reset();
            }catch (e){
              document.getElementById("msg").innerText="erro";
              console.log("erro:", e, this.responseText);
            }
          }else document.getElementById("msg").innerText="erro: " + this.status;

        }
      };

      xmlhttp.open("POST", "../../../php/adm/perguntas/criarPergunta.php", true);
      xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xmlhttp.send(params);
    }
  </script>
</head>

<body>
    <nav>
        <ul>
          <li><a href="../listarPerguntasRespostas.html">inicio</a></li>
          <li><a href="criarPergunta.html">criar pergunta</a></li>
          <li><a href="AlterarExibirPergunta.html">buscar pergunta</a></li>
          
          <li>
            <a href="#">usuários ▼</a>
            <ul>
              <li><a href="../usuario/listarUsu.html">listar usuários</a></li>
              <li><a href="../usuario/AlterarExibirUsu.html">exibir um usuário</a></li>
              <li><a href="../usuario/criarUsu.html">criar usuário</a></li>
            </ul>
          </li>
        
          <li class="sair"><a href="../../../index.php">sair</a></li>
        </ul>
    </nav>

    <main>
      <h1>criar pergunta</h1>

      <form onsubmit="event.preventDefault(); enviarPergunta();" class="coluna">
        <label>
          tipo:
          <select id="tipo" onchange="mostrarCampos()">
            <option value="discursiva">discursiva</option>
            <option value="multipla">múltipla escolha</option>
          </select>
        </label>

        <label>
          pergunta: <input type="text" id="texto">
        </label>
        <div class="multipla">
          <label>opcao 1: <input type="text" id="opc_a"></label>
          <label>opcao 2: <input type="text" id="opc_b"></label>
          <label>opcao 3: <input type="text" id="opc_c"></label>
          <label>resposta: <input type="text" id="resposta"></label>
        </div>

        <button type="submit" class="btn">enviar</button>
      </form>

      <p id="msg"></p>
    </main>
  </body>
</html>